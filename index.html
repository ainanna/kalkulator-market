<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalkulator Market vs World Market</title>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<style>
:root{
    --bg:#f4f6f9;--card:#fff;--text:#222;--border:#dcdfe3;--key:#eef1f5;
    --best-bg:#eaf8ee;--best-border:#cdebd6;
}
body.dark{
    --bg:#121212;--card:#1e1e1e;--text:#f1f1f1;--border:#333;--key:#2b2b2b;
    --best-bg:#1f3d2b;--best-border:#2e7d4f;
}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text);
display:flex;justify-content:center;align-items:center;min-height:100vh;transition:background-color .35s,color .35s;}
.wrapper{display:flex;gap:20px;flex-wrap:wrap;}
.card,.summary{background:var(--card);border-radius:12px;box-shadow:0 10px 28px rgba(0,0,0,.15);}
.card{width:420px;padding:24px;}
.summary{width:360px;padding:18px 20px;line-height:1.6;word-break:break-word;}
h3{text-align:center;margin:10px 0 16px;}
.toggle-wrap{display:flex;justify-content:flex-end;align-items:center;gap:8px;margin-bottom:8px;}
.toggle-text{font-size:12px;}
.switch{width:46px;height:24px;background:#ccc;border-radius:20px;position:relative;cursor:pointer;transition:.3s;}
.switch::after{content:'';width:18px;height:18px;background:#fff;border-radius:50%;position:absolute;top:3px;left:3px;transition:.3s;}
body.dark .switch{background:#4cd964;}
body.dark .switch::after{transform:translateX(22px);}
.mode label{display:block;font-size:14px;margin:6px 0;}
.input-group{margin-top:6px;}
input[type=number]{width:94%;padding:12px;font-size:16px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text);}

/* Keypad */
.keypad{margin-top:12px;display:grid;grid-template-columns:repeat(3,1fr);gap:8px;width:100%;}
.keypad button{padding:14px;font-size:16px;border-radius:8px;border:none;background:var(--key);cursor:pointer;}
.keypad .clear{grid-column:span 3;background:#ffbaba;font-weight:600;}
.keypad .step-select{grid-column:span 3;margin-bottom:4px;padding:6px;font-size:14px;border-radius:6px;border:1px solid var(--border);}

/* Result */
.result{margin-top:14px;font-size:14px;}
.result div{display:flex;justify-content:space-between;padding:6px 8px;border-bottom:1px dashed var(--border);}

.best{background:var(--best-bg);border:1px solid var(--best-border);}
.badge{background:#1e7e34;color:#fff;font-size:11px;padding:2px 6px;border-radius:6px;margin-left:6px;}
.market{color:#27ae60;font-weight:600;}
.world{color:#e74c3c;font-weight:600;}

/* Pulse */
@keyframes pulseHighlight{0%{transform:scale(1)}50%{transform:scale(1.03);box-shadow:0 0 14px rgba(76,217,100,.6)}100%{transform:scale(1)}}
.pulse{animation:pulseHighlight .8s ease;}

/* Responsive */
@media(max-width:768px){body{padding:16px;align-items:flex-start}.wrapper{flex-direction:column;width:100%}.card,.summary{width:100%;}}
</style>
</head>
<body>
<div class="wrapper">
<div class="card">
<div class="toggle-wrap">
    <span class="toggle-text">Dark Mode</span>
    <div id="darkSwitch" class="switch"></div>
</div>
<h3>Kalkulator Market</h3>
<div class="mode">
<label><input type="radio" name="mode" value="gross" checked> Hitung hasil bersih dari nominal kotor</label>
<label><input type="radio" name="mode" value="net"> Hitung nominal kotor dari target bersih</label>
</div>
<div class="input-group">
    <input type="number" id="amount" placeholder="Masukkan nominal">
</div>

<div class="result">
<div id="rowA"><span id="labelA"></span><strong id="valA">-</strong></div>
<div id="rowB"><span id="labelB"></span><strong id="valB">-</strong></div>
<div><span>Selisih</span><strong id="diff">-</strong></div>
</div>

<div class="keypad">
<!-- Angka -->
<button data-num="1">1</button><button data-num="2">2</button><button data-num="3">3</button>
<button data-num="4">4</button><button data-num="5">5</button><button data-num="6">6</button>
<button data-num="7">7</button><button data-num="8">8</button><button data-num="9">9</button>
<button id="btnPlus">+</button><button data-num="0">0</button><button id="btnMinus">âˆ’</button>

<!-- Step dropdown di atas tombol C -->
<select id="stepSelect" class="step-select">
<option value="1000">Step 1.000</option>
<option value="10000">Step 10.000</option>
<option value="100000">Step 100.000</option>
</select>

<button class="clear">C</button>
</div>
</div>

<div id="summary" class="summary">
Masukkan nominal untuk melihat simulasi perhitungan.
</div>
</div>

<script>
$(function(){
let STEP = parseInt($('#stepSelect').val()); 
const $amount=$('#amount');
let typingTimer=null;
const TYPING_DELAY=500;

// Dark mode toggle dengan localStorage
if(localStorage.getItem('darkMode')==='true') $('body').addClass('dark');
$('#darkSwitch').on('click', function(){
    $('body').toggleClass('dark');
    localStorage.setItem('darkMode',$('body').hasClass('dark'));
});

function format(v){return v.toLocaleString('id-ID')}
function pulse($el){$el.removeClass('pulse');void $el[0].offsetWidth;$el.addClass('pulse');}

function calculate(){
    let v=parseInt($amount.val())||0;
    if(!v){
        $('#valA,#valB,#diff').text('-');
        $('#summary').text('Masukkan nominal untuk melihat simulasi perhitungan.');
        return;
    }
    let mode=$('input[name=mode]:checked').val();
    let a,b,d,summary;
    $('.result div').removeClass('best pulse').find('.badge').remove();
    if(mode==='gross'){
        a=Math.floor(v*0.9);
        b=Math.floor(v*0.8);
        d=a-b;
        $('#labelA').text('Market (10%)');
        $('#labelB').text('World Market (20%)');
        $('#rowA').addClass('best').find('span').append('<span class="badge">Paling Menguntungkan</span>');
        summary=`Jika Anda memasukkan nominal <strong>${format(v)}</strong>, maka di <span class="market">Market</span> Anda menerima <strong>${format(a)}</strong>, sedangkan di <span class="world">World Market</span> menerima <strong>${format(b)}</strong>. Opsi paling menguntungkan adalah <span class="market">Market</span> dengan selisih <strong>${format(d)}</strong>.`;
    }else{
        a=Math.ceil(v/0.9);
        b=Math.ceil(v/0.8);
        d=b-a;
        $('#labelA').text('Pasang di Market');
        $('#labelB').text('Pasang World Market');
        $('#rowA').addClass('best').find('span').append('<span class="badge">Paling Optimal</span>');
        summary=`Untuk mendapatkan hasil bersih <strong>${format(v)}</strong>, harga di <span class="market">Market</span> harus <strong>${format(a)}</strong>, sedangkan di <span class="world">World Market</span> harus <strong>${format(b)}</strong>.`;
    }
    $('#valA').text(format(a));
    $('#valB').text(format(b));
    $('#diff').text(format(d));
    $('#summary').html(summary);
}

function triggerInput(){
    calculate();
    clearTimeout(typingTimer);
    typingTimer=setTimeout(()=>pulse($('.best')),TYPING_DELAY);
}

$amount.on('input',triggerInput);
$('.keypad button[data-num]').on('click',function(){ 
    $amount.val(($amount.val()||'')+$(this).data('num')).trigger('input'); 
});
$('#btnPlus').on('click',()=>{ 
    $amount.val((parseInt($amount.val())||0)+STEP).trigger('input'); 
});
$('#btnMinus').on('click',()=>{ 
    let v=parseInt($amount.val())||0; 
    $amount.val(Math.max(0,v-STEP)).trigger('input'); 
});
$('.clear').on('click',function(){ $amount.val(''); calculate(); });
$('#stepSelect').on('change',function(){ STEP=parseInt($(this).val()); });
$('input[name=mode]').on('change',function(){ calculate(); pulse($('.best')); });
$amount.focus();
});
</script>
</body>
</html>
